"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class NumberInsight {
  static get PATH() {
    return "/ni/{type}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      numberInsightAdvancedValidation: "Missing Mandatory fields (number and/or callback url)",
      numberInsightValidation: "Missing Mandatory field - number",
      numberInsightPatternFailure: "Number can contain digits and may include any or all of the following: white space, -,+, (, )."
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Addition NumberInsight options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }
  /**
   * Get insight on the provided number.
   *
   * @param {Object} options - The options for Number Insight
   * @param {string} options.level - the level of insight: 'basic', 'standard'
   *                 or 'advanced'.
   *                 If no `level` value is provided, or an unrecognised value
   *                 is used, 'basic' level insight will be used.
   * @param {string} options.number - the phone number to retrieve insight on
   * @param {string} options.country - 'basic' and 'standard' only.
   *                 An ISO 3166 Alpha 2 country code
   *                 https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2
   * @param {string} options. ip - 'advanced' only.
   *                 The IP address in IPv4 notation of the endpoint the
   *                 user connected from.
   * @param {Array}  options.features - 'advanced' only.
   *                 An Array detailing the information you want for this phone
   *                 number. Possible Array elements are:
   *                 - type: number is one of the following: mobile, landline,
   *                          landline_premium or unknown phone number.
   *                 - valid: number exists.
   *                 - reachable: is number available now.
   *                 - carrier: the MCCMNC for the carrier number is registered
   *                             with. This is either: <ISO country code>-FIXED
   *                             or <ISO country code>-PREMIUM.
   *                 - ported: if the user has changed carrier for number.
   *                 - roaming: the subscriber is outside their home network
   *
   * @param {string} options.callback - 'advanced' only.
   *                 The callback to be called when the API call completes.
   * @param {Number} options.callback_timeout - 'advanced' only.
   *                 The maximum wait until the Number Insight Return Parameters
   *                 are sent to callback. This is a value between 1000 - 30000ms
   *                 inclusive. The default is 30000 ms.
   * @param {string} options.callback_method - 'advanced' only.
   *                 The HTTP method used to send the Number Insight Return
   *                 Parameters to callback. Must be GET or POST. The default
   *                 value is GET.
   * @param {string} options.client_ref - 'advanced' only.
   *                 A 40 character reference string returned in the Number
   *                 Insight Return Parameters. This may be useful for your
   *                 internal reports.
   * @param {string} options['include-intermediate-callbacks'] - 'advanced' only.
   *                 Tells the Vonage platform to make callbacks as soon as an
   *                 individual piece of information is retrieved.
   */


  get(options, callback) {
    var level = options.level; // remove 'level' as it's a library-only parameter

    delete options.level;

    if (level === "advanced" || level === "advancedAsync") {
      if (level === "advanced") {
        console.warn('DEPRECATION WARNING: Number Insight Advanced with a level of "advanced" will be synchronous in v2.0+. Consider using the level "advancedAsync" to keep using the async option.');
      }

      this._numberInsightAsync(options, callback);
    } else if (level === "advancedSync") {
      this._numberInsightCommon("advanced", options, callback);
    } else if (level === "standard") {
      this._numberInsightCommon("standard", options, callback);
    } else {
      this._numberInsightCommon("basic", options, callback);
    }
  }

  _numberInsightAsync(inputParams, callback) {
    if (!inputParams.number || !inputParams.callback) {
      _Utils.default.sendError(callback, new Error(NumberInsight.ERROR_MESSAGES.numberInsightAdvancedValidation));
    } else {
      inputParams["api_key"] = this.creds.apiKey;
      inputParams["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(NumberInsight.PATH.replace("{type}", "advanced/async")), inputParams)
      }, callback);
    }
  }

  _numberInsightCommon(type, inputParams, callback) {
    if (this._validateNumber(inputParams, callback)) {
      var inputObj;

      if (typeof inputParams !== "object") {
        inputObj = {
          number: inputParams
        };
      } else {
        inputObj = inputParams;
      }

      inputObj["api_key"] = this.creds.apiKey;
      inputObj["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(NumberInsight.PATH.replace("{type}", type)), inputObj)
      }, callback);
    }
  }

  _validateNumber(inputParams, callback) {
    var numberPattern = new RegExp("^[0-9 +()-]*$");

    if (typeof inputParams === "object" && !inputParams.number) {
      _Utils.default.sendError(callback, new Error(NumberInsight.ERROR_MESSAGES.numberInsightValidation));
    } else if (typeof inputParams === "object" && !numberPattern.test(inputParams.number)) {
      _Utils.default.sendError(callback, new Error(NumberInsight.ERROR_MESSAGES.numberInsightPatternFailure));
    } else if (typeof inputParams !== "object" && (!inputParams || !numberPattern.test(inputParams))) {
      _Utils.default.sendError(callback, new Error(NumberInsight.ERROR_MESSAGES.numberInsightPatternFailure));
    }

    return true;
  }

}

var _default = NumberInsight;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJOdW1iZXJJbnNpZ2h0IiwiUEFUSCIsIkVSUk9SX01FU1NBR0VTIiwibnVtYmVySW5zaWdodEFkdmFuY2VkVmFsaWRhdGlvbiIsIm51bWJlckluc2lnaHRWYWxpZGF0aW9uIiwibnVtYmVySW5zaWdodFBhdHRlcm5GYWlsdXJlIiwiY29uc3RydWN0b3IiLCJjcmVkZW50aWFscyIsIm9wdGlvbnMiLCJjcmVkcyIsImdldCIsImNhbGxiYWNrIiwibGV2ZWwiLCJjb25zb2xlIiwid2FybiIsIl9udW1iZXJJbnNpZ2h0QXN5bmMiLCJfbnVtYmVySW5zaWdodENvbW1vbiIsImlucHV0UGFyYW1zIiwibnVtYmVyIiwiVXRpbHMiLCJzZW5kRXJyb3IiLCJFcnJvciIsImFwaUtleSIsImFwaVNlY3JldCIsImh0dHBDbGllbnQiLCJyZXF1ZXN0IiwiaG9zdCIsImFwaUhvc3QiLCJwYXRoIiwiY3JlYXRlUGF0aFdpdGhRdWVyeSIsInJlcGxhY2UiLCJ0eXBlIiwiX3ZhbGlkYXRlTnVtYmVyIiwiaW5wdXRPYmoiLCJudW1iZXJQYXR0ZXJuIiwiUmVnRXhwIiwidGVzdCJdLCJzb3VyY2VzIjpbIi4uL3NyYy9OdW1iZXJJbnNpZ2h0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxuY2xhc3MgTnVtYmVySW5zaWdodCB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvbmkve3R5cGV9L2pzb25cIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgRVJST1JfTUVTU0FHRVMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG51bWJlckluc2lnaHRBZHZhbmNlZFZhbGlkYXRpb246XG4gICAgICAgIFwiTWlzc2luZyBNYW5kYXRvcnkgZmllbGRzIChudW1iZXIgYW5kL29yIGNhbGxiYWNrIHVybClcIixcbiAgICAgIG51bWJlckluc2lnaHRWYWxpZGF0aW9uOiBcIk1pc3NpbmcgTWFuZGF0b3J5IGZpZWxkIC0gbnVtYmVyXCIsXG4gICAgICBudW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmU6XG4gICAgICAgIFwiTnVtYmVyIGNhbiBjb250YWluIGRpZ2l0cyBhbmQgbWF5IGluY2x1ZGUgYW55IG9yIGFsbCBvZiB0aGUgZm9sbG93aW5nOiB3aGl0ZSBzcGFjZSwgLSwrLCAoLCApLlwiLFxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uIE51bWJlckluc2lnaHQgb3B0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLmNyZWRzID0gY3JlZGVudGlhbHM7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW5zaWdodCBvbiB0aGUgcHJvdmlkZWQgbnVtYmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBOdW1iZXIgSW5zaWdodFxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5sZXZlbCAtIHRoZSBsZXZlbCBvZiBpbnNpZ2h0OiAnYmFzaWMnLCAnc3RhbmRhcmQnXG4gICAqICAgICAgICAgICAgICAgICBvciAnYWR2YW5jZWQnLlxuICAgKiAgICAgICAgICAgICAgICAgSWYgbm8gYGxldmVsYCB2YWx1ZSBpcyBwcm92aWRlZCwgb3IgYW4gdW5yZWNvZ25pc2VkIHZhbHVlXG4gICAqICAgICAgICAgICAgICAgICBpcyB1c2VkLCAnYmFzaWMnIGxldmVsIGluc2lnaHQgd2lsbCBiZSB1c2VkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5udW1iZXIgLSB0aGUgcGhvbmUgbnVtYmVyIHRvIHJldHJpZXZlIGluc2lnaHQgb25cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuY291bnRyeSAtICdiYXNpYycgYW5kICdzdGFuZGFyZCcgb25seS5cbiAgICogICAgICAgICAgICAgICAgIEFuIElTTyAzMTY2IEFscGhhIDIgY291bnRyeSBjb2RlXG4gICAqICAgICAgICAgICAgICAgICBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JU09fMzE2Ni0xX2FscGhhLTJcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuIGlwIC0gJ2FkdmFuY2VkJyBvbmx5LlxuICAgKiAgICAgICAgICAgICAgICAgVGhlIElQIGFkZHJlc3MgaW4gSVB2NCBub3RhdGlvbiBvZiB0aGUgZW5kcG9pbnQgdGhlXG4gICAqICAgICAgICAgICAgICAgICB1c2VyIGNvbm5lY3RlZCBmcm9tLlxuICAgKiBAcGFyYW0ge0FycmF5fSAgb3B0aW9ucy5mZWF0dXJlcyAtICdhZHZhbmNlZCcgb25seS5cbiAgICogICAgICAgICAgICAgICAgIEFuIEFycmF5IGRldGFpbGluZyB0aGUgaW5mb3JtYXRpb24geW91IHdhbnQgZm9yIHRoaXMgcGhvbmVcbiAgICogICAgICAgICAgICAgICAgIG51bWJlci4gUG9zc2libGUgQXJyYXkgZWxlbWVudHMgYXJlOlxuICAgKiAgICAgICAgICAgICAgICAgLSB0eXBlOiBudW1iZXIgaXMgb25lIG9mIHRoZSBmb2xsb3dpbmc6IG1vYmlsZSwgbGFuZGxpbmUsXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5kbGluZV9wcmVtaXVtIG9yIHVua25vd24gcGhvbmUgbnVtYmVyLlxuICAgKiAgICAgICAgICAgICAgICAgLSB2YWxpZDogbnVtYmVyIGV4aXN0cy5cbiAgICogICAgICAgICAgICAgICAgIC0gcmVhY2hhYmxlOiBpcyBudW1iZXIgYXZhaWxhYmxlIG5vdy5cbiAgICogICAgICAgICAgICAgICAgIC0gY2FycmllcjogdGhlIE1DQ01OQyBmb3IgdGhlIGNhcnJpZXIgbnVtYmVyIGlzIHJlZ2lzdGVyZWRcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGguIFRoaXMgaXMgZWl0aGVyOiA8SVNPIGNvdW50cnkgY29kZT4tRklYRURcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIDxJU08gY291bnRyeSBjb2RlPi1QUkVNSVVNLlxuICAgKiAgICAgICAgICAgICAgICAgLSBwb3J0ZWQ6IGlmIHRoZSB1c2VyIGhhcyBjaGFuZ2VkIGNhcnJpZXIgZm9yIG51bWJlci5cbiAgICogICAgICAgICAgICAgICAgIC0gcm9hbWluZzogdGhlIHN1YnNjcmliZXIgaXMgb3V0c2lkZSB0aGVpciBob21lIG5ldHdvcmtcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuY2FsbGJhY2sgLSAnYWR2YW5jZWQnIG9ubHkuXG4gICAqICAgICAgICAgICAgICAgICBUaGUgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdoZW4gdGhlIEFQSSBjYWxsIGNvbXBsZXRlcy5cbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuY2FsbGJhY2tfdGltZW91dCAtICdhZHZhbmNlZCcgb25seS5cbiAgICogICAgICAgICAgICAgICAgIFRoZSBtYXhpbXVtIHdhaXQgdW50aWwgdGhlIE51bWJlciBJbnNpZ2h0IFJldHVybiBQYXJhbWV0ZXJzXG4gICAqICAgICAgICAgICAgICAgICBhcmUgc2VudCB0byBjYWxsYmFjay4gVGhpcyBpcyBhIHZhbHVlIGJldHdlZW4gMTAwMCAtIDMwMDAwbXNcbiAgICogICAgICAgICAgICAgICAgIGluY2x1c2l2ZS4gVGhlIGRlZmF1bHQgaXMgMzAwMDAgbXMuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLmNhbGxiYWNrX21ldGhvZCAtICdhZHZhbmNlZCcgb25seS5cbiAgICogICAgICAgICAgICAgICAgIFRoZSBIVFRQIG1ldGhvZCB1c2VkIHRvIHNlbmQgdGhlIE51bWJlciBJbnNpZ2h0IFJldHVyblxuICAgKiAgICAgICAgICAgICAgICAgUGFyYW1ldGVycyB0byBjYWxsYmFjay4gTXVzdCBiZSBHRVQgb3IgUE9TVC4gVGhlIGRlZmF1bHRcbiAgICogICAgICAgICAgICAgICAgIHZhbHVlIGlzIEdFVC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuY2xpZW50X3JlZiAtICdhZHZhbmNlZCcgb25seS5cbiAgICogICAgICAgICAgICAgICAgIEEgNDAgY2hhcmFjdGVyIHJlZmVyZW5jZSBzdHJpbmcgcmV0dXJuZWQgaW4gdGhlIE51bWJlclxuICAgKiAgICAgICAgICAgICAgICAgSW5zaWdodCBSZXR1cm4gUGFyYW1ldGVycy4gVGhpcyBtYXkgYmUgdXNlZnVsIGZvciB5b3VyXG4gICAqICAgICAgICAgICAgICAgICBpbnRlcm5hbCByZXBvcnRzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gb3B0aW9uc1snaW5jbHVkZS1pbnRlcm1lZGlhdGUtY2FsbGJhY2tzJ10gLSAnYWR2YW5jZWQnIG9ubHkuXG4gICAqICAgICAgICAgICAgICAgICBUZWxscyB0aGUgVm9uYWdlIHBsYXRmb3JtIHRvIG1ha2UgY2FsbGJhY2tzIGFzIHNvb24gYXMgYW5cbiAgICogICAgICAgICAgICAgICAgIGluZGl2aWR1YWwgcGllY2Ugb2YgaW5mb3JtYXRpb24gaXMgcmV0cmlldmVkLlxuICAgKi9cbiAgZ2V0KG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGxldmVsID0gb3B0aW9ucy5sZXZlbDtcbiAgICAvLyByZW1vdmUgJ2xldmVsJyBhcyBpdCdzIGEgbGlicmFyeS1vbmx5IHBhcmFtZXRlclxuICAgIGRlbGV0ZSBvcHRpb25zLmxldmVsO1xuXG4gICAgaWYgKGxldmVsID09PSBcImFkdmFuY2VkXCIgfHwgbGV2ZWwgPT09IFwiYWR2YW5jZWRBc3luY1wiKSB7XG4gICAgICBpZiAobGV2ZWwgPT09IFwiYWR2YW5jZWRcIikge1xuICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgJ0RFUFJFQ0FUSU9OIFdBUk5JTkc6IE51bWJlciBJbnNpZ2h0IEFkdmFuY2VkIHdpdGggYSBsZXZlbCBvZiBcImFkdmFuY2VkXCIgd2lsbCBiZSBzeW5jaHJvbm91cyBpbiB2Mi4wKy4gQ29uc2lkZXIgdXNpbmcgdGhlIGxldmVsIFwiYWR2YW5jZWRBc3luY1wiIHRvIGtlZXAgdXNpbmcgdGhlIGFzeW5jIG9wdGlvbi4nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLl9udW1iZXJJbnNpZ2h0QXN5bmMob3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09IFwiYWR2YW5jZWRTeW5jXCIpIHtcbiAgICAgIHRoaXMuX251bWJlckluc2lnaHRDb21tb24oXCJhZHZhbmNlZFwiLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfSBlbHNlIGlmIChsZXZlbCA9PT0gXCJzdGFuZGFyZFwiKSB7XG4gICAgICB0aGlzLl9udW1iZXJJbnNpZ2h0Q29tbW9uKFwic3RhbmRhcmRcIiwgb3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9udW1iZXJJbnNpZ2h0Q29tbW9uKFwiYmFzaWNcIiwgb3B0aW9ucywgY2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIF9udW1iZXJJbnNpZ2h0QXN5bmMoaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFpbnB1dFBhcmFtcy5udW1iZXIgfHwgIWlucHV0UGFyYW1zLmNhbGxiYWNrKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoTnVtYmVySW5zaWdodC5FUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0QWR2YW5jZWRWYWxpZGF0aW9uKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5wdXRQYXJhbXNbXCJhcGlfa2V5XCJdID0gdGhpcy5jcmVkcy5hcGlLZXk7XG4gICAgICBpbnB1dFBhcmFtc1tcImFwaV9zZWNyZXRcIl0gPSB0aGlzLmNyZWRzLmFwaVNlY3JldDtcbiAgICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoXG4gICAgICAgIHtcbiAgICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KFxuICAgICAgICAgICAgYCR7TnVtYmVySW5zaWdodC5QQVRILnJlcGxhY2UoXCJ7dHlwZX1cIiwgXCJhZHZhbmNlZC9hc3luY1wiKX1gLFxuICAgICAgICAgICAgaW5wdXRQYXJhbXNcbiAgICAgICAgICApLFxuICAgICAgICB9LFxuICAgICAgICBjYWxsYmFja1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBfbnVtYmVySW5zaWdodENvbW1vbih0eXBlLCBpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpZiAodGhpcy5fdmFsaWRhdGVOdW1iZXIoaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSkge1xuICAgICAgdmFyIGlucHV0T2JqO1xuICAgICAgaWYgKHR5cGVvZiBpbnB1dFBhcmFtcyAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICBpbnB1dE9iaiA9IHtcbiAgICAgICAgICBudW1iZXI6IGlucHV0UGFyYW1zLFxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaW5wdXRPYmogPSBpbnB1dFBhcmFtcztcbiAgICAgIH1cbiAgICAgIGlucHV0T2JqW1wiYXBpX2tleVwiXSA9IHRoaXMuY3JlZHMuYXBpS2V5O1xuICAgICAgaW5wdXRPYmpbXCJhcGlfc2VjcmV0XCJdID0gdGhpcy5jcmVkcy5hcGlTZWNyZXQ7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShcbiAgICAgICAgICAgIGAke051bWJlckluc2lnaHQuUEFUSC5yZXBsYWNlKFwie3R5cGV9XCIsIHR5cGUpfWAsXG4gICAgICAgICAgICBpbnB1dE9ialxuICAgICAgICAgICksXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIF92YWxpZGF0ZU51bWJlcihpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcbiAgICB2YXIgbnVtYmVyUGF0dGVybiA9IG5ldyBSZWdFeHAoXCJeWzAtOSArKCktXSokXCIpO1xuXG4gICAgaWYgKHR5cGVvZiBpbnB1dFBhcmFtcyA9PT0gXCJvYmplY3RcIiAmJiAhaW5wdXRQYXJhbXMubnVtYmVyKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoTnVtYmVySW5zaWdodC5FUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0VmFsaWRhdGlvbilcbiAgICAgICk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHR5cGVvZiBpbnB1dFBhcmFtcyA9PT0gXCJvYmplY3RcIiAmJlxuICAgICAgIW51bWJlclBhdHRlcm4udGVzdChpbnB1dFBhcmFtcy5udW1iZXIpXG4gICAgKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoTnVtYmVySW5zaWdodC5FUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmUpXG4gICAgICApO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICB0eXBlb2YgaW5wdXRQYXJhbXMgIT09IFwib2JqZWN0XCIgJiZcbiAgICAgICghaW5wdXRQYXJhbXMgfHwgIW51bWJlclBhdHRlcm4udGVzdChpbnB1dFBhcmFtcykpXG4gICAgKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoTnVtYmVySW5zaWdodC5FUlJPUl9NRVNTQUdFUy5udW1iZXJJbnNpZ2h0UGF0dGVybkZhaWx1cmUpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBOdW1iZXJJbnNpZ2h0O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOzs7O0FBRUEsTUFBTUEsYUFBTixDQUFvQjtFQUNILFdBQUpDLElBQUksR0FBRztJQUNoQixPQUFPLGlCQUFQO0VBQ0Q7O0VBRXdCLFdBQWRDLGNBQWMsR0FBRztJQUMxQixPQUFPO01BQ0xDLCtCQUErQixFQUM3Qix1REFGRztNQUdMQyx1QkFBdUIsRUFBRSxrQ0FIcEI7TUFJTEMsMkJBQTJCLEVBQ3pCO0lBTEcsQ0FBUDtFQU9EO0VBQ0Q7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7RUFDRUMsV0FBVyxDQUFDQyxXQUFELEVBQTRCO0lBQUEsSUFBZEMsT0FBYyx1RUFBSixFQUFJO0lBQ3JDLEtBQUtDLEtBQUwsR0FBYUYsV0FBYjtJQUNBLEtBQUtDLE9BQUwsR0FBZUEsT0FBZjtFQUNEO0VBRUQ7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztFQUNFRSxHQUFHLENBQUNGLE9BQUQsRUFBVUcsUUFBVixFQUFvQjtJQUNyQixJQUFJQyxLQUFLLEdBQUdKLE9BQU8sQ0FBQ0ksS0FBcEIsQ0FEcUIsQ0FFckI7O0lBQ0EsT0FBT0osT0FBTyxDQUFDSSxLQUFmOztJQUVBLElBQUlBLEtBQUssS0FBSyxVQUFWLElBQXdC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