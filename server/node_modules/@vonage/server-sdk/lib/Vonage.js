"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _path = _interopRequireDefault(require("path"));

var _Credentials = _interopRequireDefault(require("./Credentials"));

var _JwtGenerator = _interopRequireDefault(require("./JwtGenerator"));

var _HashGenerator = _interopRequireDefault(require("./HashGenerator"));

var _Message = _interopRequireDefault(require("./Message"));

var _Messages = _interopRequireDefault(require("./Messages"));

var _Voice = _interopRequireDefault(require("./Voice"));

var _Number = _interopRequireDefault(require("./Number"));

var _Verify = _interopRequireDefault(require("./Verify"));

var _NumberInsight = _interopRequireDefault(require("./NumberInsight"));

var _App = _interopRequireDefault(require("./App"));

var _Account = _interopRequireDefault(require("./Account"));

var _CallsResource = _interopRequireDefault(require("./CallsResource"));

var _FilesResource = _interopRequireDefault(require("./FilesResource"));

var _Conversion = _interopRequireDefault(require("./Conversion"));

var _Media = _interopRequireDefault(require("./Media"));

var _Redact = _interopRequireDefault(require("./Redact"));

var _Pricing = _interopRequireDefault(require("./Pricing"));

var _HttpClient = _interopRequireDefault(require("./HttpClient"));

var _NullLogger = _interopRequireDefault(require("./NullLogger"));

var _ConsoleLogger = _interopRequireDefault(require("./ConsoleLogger"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var jwtGeneratorInstance = new _JwtGenerator.default();
var hashGeneratorInstance = new _HashGenerator.default();

class Vonage {
  /**
   * @param {Credentials} credentials - Vonage API credentials
   * @param {string} credentials.apiKey - the Vonage API key
   * @param {string} credentials.apiSecret - the Vonage API secret
   * @param {Object} options - Additional options
   * @param {boolean} options.debug - `true` to turn on debug logging
   * @param {Object} options.logger - Set a custom logger.
   * @param {string} options.appendToUserAgent - A value to append to the user agent.
   *                    The value will be prefixed with a `/`
   */
  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {
      debug: false
    };
    this.credentials = _Credentials.default.parse(credentials);
    this.options = Object.assign({}, options); // If no logger has been supplied but debug has been set
    // default to using the ConsoleLogger

    if (!this.options.logger && this.options.debug) {
      this.options.logger = new _ConsoleLogger.default();
    } else if (!this.options.logger) {
      // Swallow the logging
      this.options.logger = new _NullLogger.default();
    }

    var userAgent = "@vonage/server-sdk/UNKNOWN node/UNKNOWN";

    try {
      var packageDetails = require(_path.default.join(__dirname, "..", "package.json"));

      userAgent = "@vonage/server-sdk/".concat(packageDetails.version, " node/").concat(process.version.replace("v", ""));
    } catch (e) {
      console.warn("Could not load package details");
    }

    this.options.userAgent = userAgent;

    if (this.options.appendToUserAgent) {
      this.options.userAgent += " ".concat(this.options.appendToUserAgent);
    } // This is legacy, everything should use rest or api going forward


    this.options.httpClient = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials); // We have two different hosts, so we use two different HttpClients

    this.options.api = new _HttpClient.default(Object.assign({
      host: this.options.apiHost || "api.nexmo.com"
    }, this.options), this.credentials);
    this.options.rest = new _HttpClient.default(Object.assign({
      host: this.options.restHost || "rest.nexmo.com"
    }, this.options), this.credentials);
    this.message = new _Message.default(this.credentials, this.options);
    this.messages = new _Messages.default(this.credentials, this.options);
    this.voice = new _Voice.default(this.credentials, this.options);
    this.number = new _Number.default(this.credentials, this.options);
    this.verify = new _Verify.default(this.credentials, this.options);
    this.numberInsight = new _NumberInsight.default(this.credentials, this.options);
    this.applications = new _App.default(this.credentials, this.options);
    this.account = new _Account.default(this.credentials, this.options);
    this.calls = new _CallsResource.default(this.credentials, this.options);
    this.files = new _FilesResource.default(this.credentials, this.options);
    this.conversion = new _Conversion.default(this.credentials, this.options);
    this.media = new _Media.default(this.credentials, this.options);
    this.redact = new _Redact.default(this.credentials, this.options);
    this.pricing = new _Pricing.default(this.credentials, this.options);
    /**
     * @deprecated Please use vonage.applications
     */

    this.app = this.applications;
  }
  /**
   * Generate a JSON Web Token (JWT).
   *
   * The private key used upon Vonage instance construction will be used to sign
   * the JWT. The application_id you used upon Vonage instance creation will be
   * included in the claims for the JWT, however this can be overridden by passing
   * an application_id as part of the claims.
   *
   * @param {Object} claims - name/value pair claims to sign within the JWT
   *
   * @returns {String} the generated token
   */


  generateJwt() {
    var claims = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    if (claims.application_id === undefined) {
      claims.application_id = this.credentials.applicationId;
    }

    return Vonage.generateJwt(this.credentials.privateKey, claims);
  }
  /**
   * Generate a Signature Hash.
   *
   * @param {Object} params - params to generate hash from
   *
   * @returns {String} the generated token
   */


  generateSignature(params) {
    return this.credentials.generateSignature(params);
  }

}
/**
 * Generate a JSON Web Token (JWT).
 *
 * @param {String|Buffer} privateKey - the path to the private key certificate
 *          to be used when signing the claims.
 * @param {Object} claims - name/value pair claims to sign within the JWT
 *
 * @returns {String} the generated token
 */


Vonage.generateJwt = (privateKey, claims) => {
  if (!(privateKey instanceof Buffer)) {
    if (!_fs.default.existsSync(privateKey)) {
      throw new Error("File \"".concat(privateKey, "\" not found."));
    } else {
      privateKey = _fs.default.readFileSync(privateKey);
    }
  }

  return jwtGeneratorInstance.generate(privateKey, claims);
};
/**
 * Generate a Signature Hash.
 *
 * @param {String} method - the method to be used when creating the hash
 * @param {String} secret - the secret to be used when creating the hash
 * @param {Object} params - params to generate hash from
 *
 * @returns {String} the generated token
 */


Vonage.generateSignature = (method, secret, params) => {
  return hashGeneratorInstance.generate(method, secret, params);
};

var _default = Vonage;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3RHZW5lcmF0b3JJbnN0YW5jZSIsIkp3dEdlbmVyYXRvciIsImhhc2hHZW5lcmF0b3JJbnN0YW5jZSIsIkhhc2hHZW5lcmF0b3IiLCJWb25hZ2UiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImRlYnVnIiwiQ3JlZGVudGlhbHMiLCJwYXJzZSIsIk9iamVjdCIsImFzc2lnbiIsImxvZ2dlciIsIkNvbnNvbGVMb2dnZXIiLCJOdWxsTG9nZ2VyIiwidXNlckFnZW50IiwicGFja2FnZURldGFpbHMiLCJyZXF1aXJlIiwicGF0aCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ2ZXJzaW9uIiwicHJvY2VzcyIsInJlcGxhY2UiLCJlIiwiY29uc29sZSIsIndhcm4iLCJhcHBlbmRUb1VzZXJBZ2VudCIsImh0dHBDbGllbnQiLCJIdHRwQ2xpZW50IiwiaG9zdCIsInJlc3RIb3N0IiwiYXBpIiwiYXBpSG9zdCIsInJlc3QiLCJtZXNzYWdlIiwiTWVzc2FnZSIsIm1lc3NhZ2VzIiwiTWVzc2FnZXMiLCJ2b2ljZSIsIlZvaWNlIiwibnVtYmVyIiwiTnVtYmVyIiwidmVyaWZ5IiwiVmVyaWZ5IiwibnVtYmVySW5zaWdodCIsIk51bWJlckluc2lnaHQiLCJhcHBsaWNhdGlvbnMiLCJBcHAiLCJhY2NvdW50IiwiQWNjb3VudCIsImNhbGxzIiwiQ2FsbHNSZXNvdXJjZSIsImZpbGVzIiwiRmlsZXNSZXNvdXJjZSIsImNvbnZlcnNpb24iLCJDb252ZXJzaW9uIiwibWVkaWEiLCJNZWRpYSIsInJlZGFjdCIsIlJlZGFjdCIsInByaWNpbmciLCJQcmljaW5nIiwiYXBwIiwiZ2VuZXJhdGVKd3QiLCJjbGFpbXMiLCJhcHBsaWNhdGlvbl9pZCIsInVuZGVmaW5lZCIsImFwcGxpY2F0aW9uSWQiLCJwcml2YXRlS2V5IiwiZ2VuZXJhdGVTaWduYXR1cmUiLCJwYXJhbXMiLCJCdWZmZXIiLCJmcyIsImV4aXN0c1N5bmMiLCJFcnJvciIsInJlYWRGaWxlU3luYyIsImdlbmVyYXRlIiwibWV0aG9kIiwic2VjcmV0Il0sInNvdXJjZXMiOlsiLi4vc3JjL1ZvbmFnZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwicGF0aFwiO1xuXG5pbXBvcnQgQ3JlZGVudGlhbHMgZnJvbSBcIi4vQ3JlZGVudGlhbHNcIjtcbmltcG9ydCBKd3RHZW5lcmF0b3IgZnJvbSBcIi4vSnd0R2VuZXJhdG9yXCI7XG5pbXBvcnQgSGFzaEdlbmVyYXRvciBmcm9tIFwiLi9IYXNoR2VuZXJhdG9yXCI7XG5pbXBvcnQgTWVzc2FnZSBmcm9tIFwiLi9NZXNzYWdlXCI7XG5pbXBvcnQgTWVzc2FnZXMgZnJvbSBcIi4vTWVzc2FnZXNcIjtcbmltcG9ydCBWb2ljZSBmcm9tIFwiLi9Wb2ljZVwiO1xuaW1wb3J0IE51bWJlciBmcm9tIFwiLi9OdW1iZXJcIjtcbmltcG9ydCBWZXJpZnkgZnJvbSBcIi4vVmVyaWZ5XCI7XG5pbXBvcnQgTnVtYmVySW5zaWdodCBmcm9tIFwiLi9OdW1iZXJJbnNpZ2h0XCI7XG5pbXBvcnQgQXBwIGZyb20gXCIuL0FwcFwiO1xuaW1wb3J0IEFjY291bnQgZnJvbSBcIi4vQWNjb3VudFwiO1xuaW1wb3J0IENhbGxzUmVzb3VyY2UgZnJvbSBcIi4vQ2FsbHNSZXNvdXJjZVwiO1xuaW1wb3J0IEZpbGVzUmVzb3VyY2UgZnJvbSBcIi4vRmlsZXNSZXNvdXJjZVwiO1xuaW1wb3J0IENvbnZlcnNpb24gZnJvbSBcIi4vQ29udmVyc2lvblwiO1xuaW1wb3J0IE1lZGlhIGZyb20gXCIuL01lZGlhXCI7XG5pbXBvcnQgUmVkYWN0IGZyb20gXCIuL1JlZGFjdFwiO1xuaW1wb3J0IFByaWNpbmcgZnJvbSBcIi4vUHJpY2luZ1wiO1xuaW1wb3J0IEh0dHBDbGllbnQgZnJvbSBcIi4vSHR0cENsaWVudFwiO1xuaW1wb3J0IE51bGxMb2dnZXIgZnJvbSBcIi4vTnVsbExvZ2dlclwiO1xuaW1wb3J0IENvbnNvbGVMb2dnZXIgZnJvbSBcIi4vQ29uc29sZUxvZ2dlclwiO1xuXG5jb25zdCBqd3RHZW5lcmF0b3JJbnN0YW5jZSA9IG5ldyBKd3RHZW5lcmF0b3IoKTtcbmNvbnN0IGhhc2hHZW5lcmF0b3JJbnN0YW5jZSA9IG5ldyBIYXNoR2VuZXJhdG9yKCk7XG5cbmNsYXNzIFZvbmFnZSB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge0NyZWRlbnRpYWxzfSBjcmVkZW50aWFscyAtIFZvbmFnZSBBUEkgY3JlZGVudGlhbHNcbiAgICogQHBhcmFtIHtzdHJpbmd9IGNyZWRlbnRpYWxzLmFwaUtleSAtIHRoZSBWb25hZ2UgQVBJIGtleVxuICAgKiBAcGFyYW0ge3N0cmluZ30gY3JlZGVudGlhbHMuYXBpU2VjcmV0IC0gdGhlIFZvbmFnZSBBUEkgc2VjcmV0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gQWRkaXRpb25hbCBvcHRpb25zXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5kZWJ1ZyAtIGB0cnVlYCB0byB0dXJuIG9uIGRlYnVnIGxvZ2dpbmdcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMubG9nZ2VyIC0gU2V0IGEgY3VzdG9tIGxvZ2dlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuYXBwZW5kVG9Vc2VyQWdlbnQgLSBBIHZhbHVlIHRvIGFwcGVuZCB0byB0aGUgdXNlciBhZ2VudC5cbiAgICogICAgICAgICAgICAgICAgICAgIFRoZSB2YWx1ZSB3aWxsIGJlIHByZWZpeGVkIHdpdGggYSBgL2BcbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0geyBkZWJ1ZzogZmFsc2UgfSkge1xuICAgIHRoaXMuY3JlZGVudGlhbHMgPSBDcmVkZW50aWFscy5wYXJzZShjcmVkZW50aWFscyk7XG4gICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucyk7XG5cbiAgICAvLyBJZiBubyBsb2dnZXIgaGFzIGJlZW4gc3VwcGxpZWQgYnV0IGRlYnVnIGhhcyBiZWVuIHNldFxuICAgIC8vIGRlZmF1bHQgdG8gdXNpbmcgdGhlIENvbnNvbGVMb2dnZXJcbiAgICBpZiAoIXRoaXMub3B0aW9ucy5sb2dnZXIgJiYgdGhpcy5vcHRpb25zLmRlYnVnKSB7XG4gICAgICB0aGlzLm9wdGlvbnMubG9nZ2VyID0gbmV3IENvbnNvbGVMb2dnZXIoKTtcbiAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdGlvbnMubG9nZ2VyKSB7XG4gICAgICAvLyBTd2FsbG93IHRoZSBsb2dnaW5nXG4gICAgICB0aGlzLm9wdGlvbnMubG9nZ2VyID0gbmV3IE51bGxMb2dnZXIoKTtcbiAgICB9XG5cbiAgICBsZXQgdXNlckFnZW50ID0gXCJAdm9uYWdlL3NlcnZlci1zZGsvVU5LTk9XTiBub2RlL1VOS05PV05cIjtcbiAgICB0cnkge1xuICAgICAgdmFyIHBhY2thZ2VEZXRhaWxzID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uXCIsIFwicGFja2FnZS5qc29uXCIpKTtcbiAgICAgIHVzZXJBZ2VudCA9IGBAdm9uYWdlL3NlcnZlci1zZGsvJHtcbiAgICAgICAgcGFja2FnZURldGFpbHMudmVyc2lvblxuICAgICAgfSBub2RlLyR7cHJvY2Vzcy52ZXJzaW9uLnJlcGxhY2UoXCJ2XCIsIFwiXCIpfWA7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGxvYWQgcGFja2FnZSBkZXRhaWxzXCIpO1xuICAgIH1cbiAgICB0aGlzLm9wdGlvbnMudXNlckFnZW50ID0gdXNlckFnZW50O1xuICAgIGlmICh0aGlzLm9wdGlvbnMuYXBwZW5kVG9Vc2VyQWdlbnQpIHtcbiAgICAgIHRoaXMub3B0aW9ucy51c2VyQWdlbnQgKz0gYCAke3RoaXMub3B0aW9ucy5hcHBlbmRUb1VzZXJBZ2VudH1gO1xuICAgIH1cblxuICAgIC8vIFRoaXMgaXMgbGVnYWN5LCBldmVyeXRoaW5nIHNob3VsZCB1c2UgcmVzdCBvciBhcGkgZ29pbmcgZm9yd2FyZFxuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50ID0gbmV3IEh0dHBDbGllbnQoXG4gICAgICBPYmplY3QuYXNzaWduKFxuICAgICAgICB7IGhvc3Q6IHRoaXMub3B0aW9ucy5yZXN0SG9zdCB8fCBcInJlc3QubmV4bW8uY29tXCIgfSxcbiAgICAgICAgdGhpcy5vcHRpb25zXG4gICAgICApLFxuICAgICAgdGhpcy5jcmVkZW50aWFsc1xuICAgICk7XG5cbiAgICAvLyBXZSBoYXZlIHR3byBkaWZmZXJlbnQgaG9zdHMsIHNvIHdlIHVzZSB0d28gZGlmZmVyZW50IEh0dHBDbGllbnRzXG4gICAgdGhpcy5vcHRpb25zLmFwaSA9IG5ldyBIdHRwQ2xpZW50KFxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgeyBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIiB9LFxuICAgICAgICB0aGlzLm9wdGlvbnNcbiAgICAgICksXG4gICAgICB0aGlzLmNyZWRlbnRpYWxzXG4gICAgKTtcbiAgICB0aGlzLm9wdGlvbnMucmVzdCA9IG5ldyBIdHRwQ2xpZW50KFxuICAgICAgT2JqZWN0LmFzc2lnbihcbiAgICAgICAgeyBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiIH0sXG4gICAgICAgIHRoaXMub3B0aW9uc1xuICAgICAgKSxcbiAgICAgIHRoaXMuY3JlZGVudGlhbHNcbiAgICApO1xuXG4gICAgdGhpcy5tZXNzYWdlID0gbmV3IE1lc3NhZ2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLm1lc3NhZ2VzID0gbmV3IE1lc3NhZ2VzKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy52b2ljZSA9IG5ldyBWb2ljZSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubnVtYmVyID0gbmV3IE51bWJlcih0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMudmVyaWZ5ID0gbmV3IFZlcmlmeSh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubnVtYmVySW5zaWdodCA9IG5ldyBOdW1iZXJJbnNpZ2h0KHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5hcHBsaWNhdGlvbnMgPSBuZXcgQXBwKHRoaXMuY3JlZGVudGlhbHMsIHRoaXMub3B0aW9ucyk7XG4gICAgdGhpcy5hY2NvdW50ID0gbmV3IEFjY291bnQodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNhbGxzID0gbmV3IENhbGxzUmVzb3VyY2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmZpbGVzID0gbmV3IEZpbGVzUmVzb3VyY2UodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLmNvbnZlcnNpb24gPSBuZXcgQ29udmVyc2lvbih0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMubWVkaWEgPSBuZXcgTWVkaWEodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnJlZGFjdCA9IG5ldyBSZWRhY3QodGhpcy5jcmVkZW50aWFscywgdGhpcy5vcHRpb25zKTtcbiAgICB0aGlzLnByaWNpbmcgPSBuZXcgUHJpY2luZyh0aGlzLmNyZWRlbnRpYWxzLCB0aGlzLm9wdGlvbnMpO1xuXG4gICAgLyoqXG4gICAgICogQGRlcHJlY2F0ZWQgUGxlYXNlIHVzZSB2b25hZ2UuYXBwbGljYXRpb25zXG4gICAgICovXG4gICAgdGhpcy5hcHAgPSB0aGlzLmFwcGxpY2F0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIEpTT04gV2ViIFRva2VuIChKV1QpLlxuICAgKlxuICAgKiBUaGUgcHJpdmF0ZSBrZXkgdXNlZCB1cG9uIFZvbmFnZSBpbnN0YW5jZSBjb25zdHJ1Y3Rpb24gd2lsbCBiZSB1c2VkIHRvIHNpZ25cbiAgICogdGhlIEpXVC4gVGhlIGFwcGxpY2F0aW9uX2lkIHlvdSB1c2VkIHVwb24gVm9uYWdlIGluc3RhbmNlIGNyZWF0aW9uIHdpbGwgYmVcbiAgICogaW5jbHVkZWQgaW4gdGhlIGNsYWltcyBmb3IgdGhlIEpXVCwgaG93ZXZlciB0aGlzIGNhbiBiZSBvdmVycmlkZGVuIGJ5IHBhc3NpbmdcbiAgICogYW4gYXBwbGljYXRpb25faWQgYXMgcGFydCBvZiB0aGUgY2xhaW1zLlxuICAgKlxuICAgKiBAcGFyYW0ge09iamVjdH0gY2xhaW1zIC0gbmFtZS92YWx1ZSBwYWlyIGNsYWltcyB0byBzaWduIHdpdGhpbiB0aGUgSldUXG4gICAqXG4gICAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBnZW5lcmF0ZWQgdG9rZW5cbiAgICovXG5cbiAgZ2VuZXJhdGVKd3QoY2xhaW1zID0ge30pIHtcbiAgICBpZiAoY2xhaW1zLmFwcGxpY2F0aW9uX2lkID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGNsYWltcy5hcHBsaWNhdGlvbl9pZCA9IHRoaXMuY3JlZGVudGlhbHMuYXBwbGljYXRpb25JZDtcbiAgICB9XG4gICAgcmV0dXJuIFZvbmFnZS5nZW5lcmF0ZUp3dCh0aGlzLmNyZWRlbnRpYWxzLnByaXZhdGVLZXksIGNsYWltcyk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgYSBTaWduYXR1cmUgSGFzaC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IHBhcmFtcyAtIHBhcmFtcyB0byBnZW5lcmF0ZSBoYXNoIGZyb21cbiAgICpcbiAgICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICAgKi9cbiAgZ2VuZXJhdGVTaWduYXR1cmUocGFyYW1zKSB7XG4gICAgcmV0dXJuIHRoaXMuY3JlZGVudGlhbHMuZ2VuZXJhdGVTaWduYXR1cmUocGFyYW1zKTtcbiAgfVxufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgSlNPTiBXZWIgVG9rZW4gKEpXVCkuXG4gKlxuICogQHBhcmFtIHtTdHJpbmd8QnVmZmVyfSBwcml2YXRlS2V5IC0gdGhlIHBhdGggdG8gdGhlIHByaXZhdGUga2V5IGNlcnRpZmljYXRlXG4gKiAgICAgICAgICB0byBiZSB1c2VkIHdoZW4gc2lnbmluZyB0aGUgY2xhaW1zLlxuICogQHBhcmFtIHtPYmplY3R9IGNsYWltcyAtIG5hbWUvdmFsdWUgcGFpciBjbGFpbXMgdG8gc2lnbiB3aXRoaW4gdGhlIEpXVFxuICpcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHRoZSBnZW5lcmF0ZWQgdG9rZW5cbiAqL1xuVm9uYWdlLmdlbmVyYXRlSnd0ID0gKHByaXZhdGVLZXksIGNsYWltcykgPT4ge1xuICBpZiAoIShwcml2YXRlS2V5IGluc3RhbmNlb2YgQnVmZmVyKSkge1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhwcml2YXRlS2V5KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlIFwiJHtwcml2YXRlS2V5fVwiIG5vdCBmb3VuZC5gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJpdmF0ZUtleSA9IGZzLnJlYWRGaWxlU3luYyhwcml2YXRlS2V5KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGp3dEdlbmVyYXRvckluc3RhbmNlLmdlbmVyYXRlKHByaXZhdGVLZXksIGNsYWltcyk7XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlIGEgU2lnbmF0dXJlIEhhc2guXG4gKlxuICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCAtIHRoZSBtZXRob2QgdG8gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIHRoZSBoYXNoXG4gKiBAcGFyYW0ge1N0cmluZ30gc2VjcmV0IC0gdGhlIHNlY3JldCB0byBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIGhhc2hcbiAqIEBwYXJhbSB7T2JqZWN0fSBwYXJhbXMgLSBwYXJhbXMgdG8gZ2VuZXJhdGUgaGFzaCBmcm9tXG4gKlxuICogQHJldHVybnMge1N0cmluZ30gdGhlIGdlbmVyYXRlZCB0b2tlblxuICovXG5Wb25hZ2UuZ2VuZXJhdGVTaWduYXR1cmUgPSAobWV0aG9kLCBzZWNyZXQsIHBhcmFtcykgPT4ge1xuICByZXR1cm4gaGFzaEdlbmVyYXRvckluc3RhbmNlLmdlbmVyYXRlKG1ldGhvZCwgc2VjcmV0LCBwYXJhbXMpO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgVm9uYWdlO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSxvQkFBb0IsR0FBRyxJQUFJQyxxQkFBSixFQUE3QjtBQUNBLElBQU1DLHFCQUFxQixHQUFHLElBQUlDLHNCQUFKLEVBQTlCOztBQUVBLE1BQU1DLE1BQU4sQ0FBYTtFQUNYO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0VDLFdBQVcsQ0FBQ0MsV0FBRCxFQUEwQztJQUFBLElBQTVCQyxPQUE0Qix1RUFBbEI7TUFBRUMsS0FBSyxFQUFFO0lBQVQsQ0FBa0I7SUFDbkQsS0FBS0YsV0FBTCxHQUFtQkcsb0JBQUEsQ0FBWUMsS0FBWixDQUFrQkosV0FBbEIsQ0FBbkI7SUFDQSxLQUFLQyxPQUFMLEdBQWVJLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JMLE9BQWxCLENBQWYsQ0FGbUQsQ0FJbkQ7SUFDQTs7SUFDQSxJQUFJLENBQUMsS0FBS0EsT0FBTCxDQUFhTSxNQUFkLElBQXdCLEtBQUtOLE9BQUwsQ0FBYUMsS0FBekMsRUFBZ0Q7TUFDOUMsS0FBS0QsT0FBTCxDQUFhTSxNQUFiLEdBQXNCLElBQUlDLHNCQUFKLEVBQXRCO0lBQ0QsQ0FGRCxNQUVPLElBQUksQ0FBQyxLQUFLUCxPQUFMLENBQWFNLE1BQWxCLEVBQTBCO01BQy9CO01BQ0EsS0FBS04sT0FBTCxDQUFhTSxNQUFiLEdBQXNCLElBQUlFLG1CQUFKLEVBQXRCO0lBQ0Q7O0lBRUQsSUFBSUMsU0FBUyxHQUFHLHlDQUFoQjs7SUFDQSxJQUFJO01BQ0YsSUFBSUMsY0FBYyxHQUFHQyxPQUFPLENBQUNDLGFBQUEsQ0FBS0MsSUFBTCxDQUFVQyxTQUFWLEVBQXFCLElBQXJCLEVBQTJCLGNBQTNCLENBQUQsQ0FBNUI7O01BQ0FMLFNBQVMsZ0NBQ1BDLGNBQWMsQ0FBQ0ssT0FEUixtQkFFQUMsT0FBTyxDQUFDRCxPQUFSLENBQWdCRSxPQUFoQixDQUF3QixHQUF4QixFQUE2QixFQUE3QixDQUZBLENBQVQ7SUFHRCxDQUxELENBS0UsT0FBT0MsQ0FBUCxFQUFVO01BQ1ZDLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLGdDQUFiO0lBQ0Q7O0lBQ0QsS0FBS3BCLE9BQUwsQ0FBYVMsU0FBYixHQUF5QkEsU0FBekI7O0lBQ0EsSUFBSSxLQUFLVCxPQUFMLENBQWFxQixpQkFBakIsRUFBb0M7TUFDbEMsS0FBS3JCLE9BQUwsQ0FBYVMsU0FBYixlQUE4QixLQUFLVCxPQUFMLENBQWFxQixpQkFBM0M7SUFDRCxDQXpCa0QsQ0EyQm5EOzs7SUFDQSxLQUFLckIsT0FBTCxDQUFhc0IsVUFBYixHQUEwQixJQUFJQyxtQkFBSixDQUN4Qm5CLE1BQU0sQ0FBQ0MsTUFBUCxDQUNFO01BQUVtQixJQUFJLEVBQUUsS0FBS3hCLE9BQUwsQ0FBYXlCLFFBQWIsSUFBeUI7SUFBakMsQ0FERixFQUVFLEtBQUt6QixPQUZQLENBRHdCLEVBS3hCLEtBQUtELFdBTG1CLENBQTFCLENBNUJtRCxDQW9DbkQ7O0lBQ0EsS0FBS0MsT0FBTCxDQUFhMEIsR0FBYixHQUFtQixJQUFJSCxtQkFBSixDQUNqQm5CLE1BQU0sQ0FBQ0MsTUFBUCxDQUNFO01BQUVtQixJQUFJLEVBQUUsS0FBS3hCLE9BQUwsQ0FBYTJCLE9BQWIsSUFBd0I7SUFBaEMsQ0FERixFQUVFLEtBQUszQixPQUZQLENBRGlCLEVBS2pCLEtBQUtELFdBTFksQ0FBbkI7SUFPQSxLQUFLQyxPQUFMLENBQWE0QixJQUFiLEdBQW9CLElBQUlMLG1CQUFKLENBQ2xCbkIsTUFBTSxDQUFDQyxNQUFQLENBQ0U7TUFBRW1CLElBQUksRUFBRSxLQUFLeEIsT0FBTCxDQUFheUIsUUFBYixJQUF5QjtJQUFqQyxDQURGLEVBRUUsS0FBS3pCLE9BRlAsQ0FEa0IsRUFLbEIsS0FBS0QsV0FMYSxDQUFwQjtJQVFBLEtBQUs4QixPQUFMLEdBQWUsSUFBSUMsZ0JBQUosQ0FBWSxLQUFLL0IsV0FBakIsRUFBOEIsS0FBS0MsT0FBbkMsQ0FBZjtJQUNBLEtBQUsrQixRQUFMLEdBQWdCLElBQUlDLGlCQUFKLENBQWEsS0FBS2pDLFdBQWxCLEVBQStCLEtBQUtDLE9BQXBDLENBQWhCO0lBQ0EsS0FBS2lDLEtBQUwsR0FBYSxJQUFJQyxjQUFKLENBQVUsS0FBS25DLFdBQWYsRUFBNEIsS0FBS0MsT0FBakMsQ0FBYjtJQUNBLEtBQUttQyxNQUFMLEdBQWMsSUFBSUMsZUFBSixDQUFXLEtBQUtyQyxXQUFoQixFQUE2QixLQUFLQyxPQUFsQyxDQUFkO0lBQ0EsS0FBS3FDLE1BQUwsR0FBYyxJQUFJQyxlQUFKLENBQVcsS0FBS3ZDLFdBQWhCLEVBQTZCLEtBQUtDLE9BQWxDLENBQWQ7SUFDQSxLQUFLdUMsYUFBTCxHQUFxQixJQUFJQyxzQkFBSixDQUFrQixLQUFLekMsV0FBdkIsRUFBb0MsS0FBS0MsT0FBekMsQ0FBckI7SUFDQSxLQUFLeUMsWUFBTCxHQUFvQixJQUFJQyxZQUFKLENBQVEsS0FBSzNDLFdBQWIsRUFBMEIsS0FBS0MsT0FBL0IsQ0FBcEI7SUFDQSxLQUFLMkMsT0FBTCxHQUFlLElBQUlDLGdCQUFKLENBQVksS0FBSzdDLFdBQWpCLEVBQThCLEtBQUtDLE9BQW5DLENBQWY7SUFDQSxLQUFLNkMsS0FBTCxHQUFhLElBQUlDLHNCQUFKLENBQWtCLEtBQUsvQyxXQUF2QixFQUFvQyxLQUFLQyxPQUF6QyxDQUFiO0lBQ0EsS0FBSytDLEtBQUwsR0FBYSxJQUFJQyxzQkFBSixDQUFrQixLQUFLakQsV0FBdkIsRUFBb0MsS0FBS0MsT0FBekMsQ0FBYjtJQUNBLEtBQUtpRCxVQUFMLEdBQWtCLElBQUlDLG1CQUFKLENBQWUsS0FBS25ELFdBQXBCLEVBQWlDLEtBQUtDLE9BQXRDLENBQWxCO0lBQ0EsS0FBS21ELEtBQUwsR0FBYSxJQUFJQyxjQUFKLENBQVUsS0FBS3JELFdBQWYsRUFBNEIsS0FBS0MsT0FBakMsQ0FBYjtJQUNBLEtBQUtxRCxNQUFMLEdBQWMsSUFBSUMsZUFBSixDQUFXLEtBQUt2RCxXQUFoQixFQUE2QixLQUFLQyxPQUFsQyxDQUFkO0lBQ0EsS0FBS3VELE9BQUwsR0FBZSxJQUFJQyxnQkFBSixDQUFZLEtBQUt6RCxXQUFqQixFQUE4QixLQUFLQyxPQUFuQyxDQUFmO0lBRUE7QUFDSjtBQUNBOztJQUNJLEtBQUt5RCxHQUFMLEdBQVcsS0FBS2hCLFlBQWhCO0VBQ0Q7RUFFRDtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztFQUVFaUIsV0FBVyxHQUFjO0lBQUEsSUFBYkMsTUFBYSx1RUFBSixFQUFJOztJQUN2QixJQUFJQSxNQUFNLENBQUNDLGNBQVAsS0FBMEJDLFNBQTlCLEVBQXlDO01BQ3ZDRixNQUFNLENBQUNDLGNBQVAsR0FBd0IsS0FBSzdELFdBQUwsQ0FBaUIrRCxhQUF6QztJQUNEOztJQUNELE9BQU9qRSxNQUFNLENBQUM2RCxXQUFQLENBQW1CLEtBQUszRCxXQUFMLENBQWlCZ0UsVUFBcEMsRUFBZ0RKLE1BQWhELENBQVA7RUFDRDtFQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7RUFDRUssaUJBQWlCLENBQUNDLE1BQUQsRUFBUztJQUN4QixPQUFPLEtBQUtsRSxXQUFMLENBQWlCaUUsaUJBQWpCLENBQW1DQyxNQUFuQyxDQUFQO0VBQ0Q7O0FBakhVO0FBb0hiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ0FwRSxNQUFNLENBQUM2RCxXQUFQLEdBQXFCLENBQUNLLFVBQUQsRUFBYUosTUFBYixLQUF3QjtFQUMzQyxJQUFJLEVBQUVJLFVBQVUsWUFBWUcsTUFBeEIsQ0FBSixFQUFxQztJQUNuQyxJQUFJLENBQUNDLFdBQUEsQ0FBR0MsVUFBSCxDQUFjTCxVQUFkLENBQUwsRUFBZ0M7TUFDOUIsTUFBTSxJQUFJTSxLQUFKLGtCQUFtQk4sVUFBbkIsbUJBQU47SUFDRCxDQUZELE1BRU87TUFDTEEsVUFBVSxHQUFHSSxXQUFBLENBQUdHLFlBQUgsQ0FBZ0JQLFVBQWhCLENBQWI7SUFDRDtFQUNGOztFQUNELE9BQU90RSxvQkFBb0IsQ0FBQzhFLFFBQXJCLENBQThCUixVQUE5QixFQUEwQ0osTUFBMUMsQ0FBUDtBQUNELENBVEQ7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUNBOUQsTUFBTSxDQUFDbUUsaUJBQVAsR0FBMkIsQ0FBQ1EsTUFBRCxFQUFTQyxNQUFULEVBQWlCUixNQUFqQixLQUE0QjtFQUNyRCxPQUFPdEUscUJBQXFCLENBQUM0RSxRQUF0QixDQUErQkMsTUFBL0IsRUFBdUNDLE1BQXZDLEVBQStDUixNQUEvQyxDQUFQO0FBQ0QsQ0FGRDs7ZUFJZXBFLE0ifQ==