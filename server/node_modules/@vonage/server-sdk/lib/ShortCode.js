"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var querystring = require("querystring");
/**
 * Provides access to the `ShortCode` endpoint.
 */


class ShortCode {
  static get PATH() {
    return "/sc/us/${type}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      to: "Invalid to address",
      msgParams: "Invalid shortcode message parameters"
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Additional ShortCode options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }

  _sendRequest(endpoint, method, callback) {
    endpoint.path = endpoint.path + (endpoint.path.indexOf("?") > 0 ? "&" : "?") + querystring.stringify({
      api_key: this.creds.apiKey,
      api_secret: this.creds.apiSecret
    });
    this.options.httpClient.request(endpoint, method, callback);
  }

  _sendViaShortcode(type, recipient, messageParams, opts, callback) {
    if (!recipient) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.to));
    }

    if (!messageParams || !Object.keys(messageParams)) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.msgParams));
    }

    opts = opts || {};
    var path = ShortCode.PATH.replace("${type}", type);
    Object.keys(messageParams).forEach(function (key) {
      opts[key] = messageParams[key];
    });
    opts.to = recipient;
    path += "?" + querystring.stringify(opts);
    this.options.logger.info("sending message from shortcode " + type + " to " + recipient + " with parameters " + JSON.stringify(messageParams));

    this._sendRequest({
      host: this.options.restHost || "rest.nexmo.com",
      path: path
    }, "POST", function (err, apiResponse) {
      if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
        _Utils.default.sendError(callback, new Error(apiResponse.messages[0]["error-text"]), apiResponse);
      } else {
        if (callback) callback(err, apiResponse);
      }
    });
  }

  shortcodeAlert(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("alert", recipient, messageParams, opts, callback);
  }

  shortcode2FA(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("2fa", recipient, messageParams, opts, callback);
  }

  shortcodeMarketing(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("marketing", recipient, messageParams, opts, callback);
  }

}

var _default = ShortCode;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJxdWVyeXN0cmluZyIsInJlcXVpcmUiLCJTaG9ydENvZGUiLCJQQVRIIiwiRVJST1JfTUVTU0FHRVMiLCJ0byIsIm1zZ1BhcmFtcyIsImNvbnN0cnVjdG9yIiwiY3JlZGVudGlhbHMiLCJvcHRpb25zIiwiY3JlZHMiLCJfc2VuZFJlcXVlc3QiLCJlbmRwb2ludCIsIm1ldGhvZCIsImNhbGxiYWNrIiwicGF0aCIsImluZGV4T2YiLCJzdHJpbmdpZnkiLCJhcGlfa2V5IiwiYXBpS2V5IiwiYXBpX3NlY3JldCIsImFwaVNlY3JldCIsImh0dHBDbGllbnQiLCJyZXF1ZXN0IiwiX3NlbmRWaWFTaG9ydGNvZGUiLCJ0eXBlIiwicmVjaXBpZW50IiwibWVzc2FnZVBhcmFtcyIsIm9wdHMiLCJVdGlscyIsInNlbmRFcnJvciIsIkVycm9yIiwiT2JqZWN0Iiwia2V5cyIsInJlcGxhY2UiLCJmb3JFYWNoIiwia2V5IiwibG9nZ2VyIiwiaW5mbyIsIkpTT04iLCJob3N0IiwicmVzdEhvc3QiLCJlcnIiLCJhcGlSZXNwb25zZSIsInN0YXR1cyIsIm1lc3NhZ2VzIiwic2hvcnRjb2RlQWxlcnQiLCJzaG9ydGNvZGUyRkEiLCJzaG9ydGNvZGVNYXJrZXRpbmciXSwic291cmNlcyI6WyIuLi9zcmMvU2hvcnRDb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxudmFyIHF1ZXJ5c3RyaW5nID0gcmVxdWlyZShcInF1ZXJ5c3RyaW5nXCIpO1xuXG4vKipcbiAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgYFNob3J0Q29kZWAgZW5kcG9pbnQuXG4gKi9cbmNsYXNzIFNob3J0Q29kZSB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvc2MvdXMvJHt0eXBlfS9qc29uXCI7XG4gIH1cblxuICBzdGF0aWMgZ2V0IEVSUk9SX01FU1NBR0VTKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0bzogXCJJbnZhbGlkIHRvIGFkZHJlc3NcIixcbiAgICAgIG1zZ1BhcmFtczogXCJJbnZhbGlkIHNob3J0Y29kZSBtZXNzYWdlIHBhcmFtZXRlcnNcIixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uYWwgU2hvcnRDb2RlIG9wdGlvbnMuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjcmVkZW50aWFscywgb3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5jcmVkcyA9IGNyZWRlbnRpYWxzO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICBfc2VuZFJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgY2FsbGJhY2spIHtcbiAgICBlbmRwb2ludC5wYXRoID1cbiAgICAgIGVuZHBvaW50LnBhdGggK1xuICAgICAgKGVuZHBvaW50LnBhdGguaW5kZXhPZihcIj9cIikgPiAwID8gXCImXCIgOiBcIj9cIikgK1xuICAgICAgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KHtcbiAgICAgICAgYXBpX2tleTogdGhpcy5jcmVkcy5hcGlLZXksXG4gICAgICAgIGFwaV9zZWNyZXQ6IHRoaXMuY3JlZHMuYXBpU2VjcmV0LFxuICAgICAgfSk7XG4gICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChlbmRwb2ludCwgbWV0aG9kLCBjYWxsYmFjayk7XG4gIH1cblxuICBfc2VuZFZpYVNob3J0Y29kZSh0eXBlLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFyZWNpcGllbnQpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihjYWxsYmFjaywgbmV3IEVycm9yKFNob3J0Q29kZS5FUlJPUl9NRVNTQUdFUy50bykpO1xuICAgIH1cbiAgICBpZiAoIW1lc3NhZ2VQYXJhbXMgfHwgIU9iamVjdC5rZXlzKG1lc3NhZ2VQYXJhbXMpKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihTaG9ydENvZGUuRVJST1JfTUVTU0FHRVMubXNnUGFyYW1zKSk7XG4gICAgfVxuICAgIG9wdHMgPSBvcHRzIHx8IHt9O1xuICAgIHZhciBwYXRoID0gU2hvcnRDb2RlLlBBVEgucmVwbGFjZShcIiR7dHlwZX1cIiwgdHlwZSk7XG4gICAgT2JqZWN0LmtleXMobWVzc2FnZVBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICBvcHRzW2tleV0gPSBtZXNzYWdlUGFyYW1zW2tleV07XG4gICAgfSk7XG4gICAgb3B0cy50byA9IHJlY2lwaWVudDtcbiAgICBwYXRoICs9IFwiP1wiICsgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9wdHMpO1xuICAgIHRoaXMub3B0aW9ucy5sb2dnZXIuaW5mbyhcbiAgICAgIFwic2VuZGluZyBtZXNzYWdlIGZyb20gc2hvcnRjb2RlIFwiICtcbiAgICAgICAgdHlwZSArXG4gICAgICAgIFwiIHRvIFwiICtcbiAgICAgICAgcmVjaXBpZW50ICtcbiAgICAgICAgXCIgd2l0aCBwYXJhbWV0ZXJzIFwiICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcylcbiAgICApO1xuICAgIHRoaXMuX3NlbmRSZXF1ZXN0KFxuICAgICAge1xuICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiLFxuICAgICAgICBwYXRoOiBwYXRoLFxuICAgICAgfSxcbiAgICAgIFwiUE9TVFwiLFxuICAgICAgZnVuY3Rpb24gKGVyciwgYXBpUmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKCFlcnIgJiYgYXBpUmVzcG9uc2Uuc3RhdHVzICYmIGFwaVJlc3BvbnNlLm1lc3NhZ2VzWzBdLnN0YXR1cyA+IDApIHtcbiAgICAgICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgICAgIG5ldyBFcnJvcihhcGlSZXNwb25zZS5tZXNzYWdlc1swXVtcImVycm9yLXRleHRcIl0pLFxuICAgICAgICAgICAgYXBpUmVzcG9uc2VcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soZXJyLCBhcGlSZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgc2hvcnRjb2RlQWxlcnQocmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlbmRWaWFTaG9ydGNvZGUoXCJhbGVydFwiLCByZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKTtcbiAgfVxuICBzaG9ydGNvZGUyRkEocmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX3NlbmRWaWFTaG9ydGNvZGUoXCIyZmFcIiwgcmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjayk7XG4gIH1cbiAgc2hvcnRjb2RlTWFya2V0aW5nKHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9zZW5kVmlhU2hvcnRjb2RlKFxuICAgICAgXCJtYXJrZXRpbmdcIixcbiAgICAgIHJlY2lwaWVudCxcbiAgICAgIG1lc3NhZ2VQYXJhbXMsXG4gICAgICBvcHRzLFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFNob3J0Q29kZTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUFFQTs7OztBQUVBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLGFBQUQsQ0FBekI7QUFFQTtBQUNBO0FBQ0E7OztBQUNBLE1BQU1DLFNB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